<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../WEB-INF/AdminD_Template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="content">
        <section class="single-page-title single-page-title-contact" >
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <h2>Modificar JRV</h2>
                    </div>
                </div>
            </div>
        </section>

        <section class="contact-section">
            <div class="container" style="-webkit-box-shadow: 2px 2px 18px 0px rgba(0,0,0,0.75);
                 -moz-box-shadow: 2px 2px 18px 0px rgba(0,0,0,0.75);
                 box-shadow: 2px 2px 18px 0px rgba(0,0,0,0.75); padding:1%;max-width: 700px;">


                <h:panelGroup layout="block" class="alert alert-danger" rendered="#{not empty facesContext.messageList}">
                    <h:messages/>
                </h:panelGroup>

                <div class="contact-form mt-50">
                    <h:form prependId="false">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <h:outputLabel value="Fecha de inicio:" for="fechaInicio" />
                                    <h:inputText class="form-control" required="true" id="fechaInicio" value="#{jrvBean.jrv.fechaInicio}" requiredMessage="Debes ingresar una fecha de inicio" converterMessage="El formato de la fecha de inicio debe ser Mes/dia/año" a:placeholder="Fecha de inicio">
                                        <f:convertDateTime type="date" pattern="MM/dd/yyyy" />
                                    </h:inputText>
                                </div>

                                <div class="form-group">
                                    <h:outputLabel value="Fecha de finalización:" for="fechaFin" id="hola"/>
                                    <h:inputText class="form-control" required="true" id="fechaFin" value="#{jrvBean.jrv.fechaFinal}" requiredMessage="Debes ingresar una fecha de finalización" converterMessage="El formato de la fecha de finalización debe ser Mes/dia/año" a:placeholder="Fecha de finalización">
                                        <f:convertDateTime type="date" pattern="MM/dd/yyyy" />
                                    </h:inputText>
                                </div>

                                <div class="form-group" style="display: none;">
                                    <h:outputLabel value="Seleccione una eleccion:" for="elecciones" />
                                    <h:selectOneMenu id="elecciones" class="form-control" value="#{jrvBean.jrv.idElecciones}" title="IdElecciones" required="true" requiredMessage="No hay ninguna elección activa" >
                                        <f:selectItems value="#{jrvBean.listaElecciones}" var="eleccion"
                                                       itemValue="#{eleccion}"
                                                       itemLabel="#{eleccion.titulo}"/>

                                    </h:selectOneMenu>
                                </div>

                                <div class="form-group">
                                    <h:outputLabel value="Seleccione un centro de votacion" for="centroVotacion" />
                                    <h:selectOneMenu id="centroVotacion" class="form-control centroVotacion" value="#{jrvBean.jrv.idCentroVotacion}" title="IdCentroVotacion" required="true" requiredMessage="No hay centros de votaciones disponibles">
                                        <!-- TODO: update below reference to list of available items-->

                                        <f:selectItems value="#{jrvBean.listaCentroVotaciones}" var="centro"
                                                       itemValue="#{centro}"
                                                       itemLabel="#{centro.nombre}"/>
                                    </h:selectOneMenu>
                                </div>
                            </div> <!-- col-md-4 -->

                            <div class="col-md-6">
                                <div class="form-group">
                                    <h:outputLabel value="Seleccione un presidente" for="presidente" />
                                    <h:selectOneMenu id="presidente" class="form-control presidente" value="#{jrvBean.jrv.idPresidente}" title="IdPresidente" required="true" requiredMessage="No hay usuarios para presidente disponibles">

                                        <c:if test="#{not empty jrvBean.listaJrvs}">

                                            <c:forEach items="#{jrvBean.listaJrvs}" var="jrv">

                                                <c:forEach items="#{jrvBean.listaUsuarios}" var="presidente">
                                                    <c:if test="#{jrv.idPresidente.idUsuario ne presidente.idUsuario}">
                                                        <f:selectItem  itemValue="#{presidente}"
                                                                       itemLabel="#{presidente.idCiudadano.nombres} #{presidente.idCiudadano.apellidos}"/>
                                                    </c:if>
                                                </c:forEach>
                                            </c:forEach>

                                        </c:if>

                                        <c:if test="#{empty jrvBean.listaJrvs}">

                                            <f:selectItems value="#{jrvBean.listaUsuarios}" var="presidente" itemValue="#{presidente}"
                                                           itemLabel="#{presidente.nombres} #{presidente.apellidos}"/>

                                        </c:if>


                                    </h:selectOneMenu>
                                </div>
                                <div class="form-group">
                                    <h:outputLabel value="Seleccione un secretario" for="secretario" />

                                    <h:selectOneMenu id="secretario" class="form-control secretario js-states" value="#{jrvBean.jrv.idSecretario}" title="Secretario" required="true" requiredMessage="No hay ciudadanos para secretario disponibles">                                      
                                        <c:if test="#{not empty jrvBean.listaJrvs}">

                                            <c:forEach items="#{jrvBean.listaJrvs}" var="jrv">

                                                <c:forEach items="#{jrvBean.listaCiudadanos}" var="ciudadano">
                                                    <c:if test="#{(jrvBean.jrv.idSecretario ne ciudadano.idCiudadano) and (jrv.idVocal.idCiudadano ne ciudadano.idCiudadano)}">
                                                        <f:selectItem itemValue="#{ciudadano}"
                                                                      itemLabel="#{ciudadano.nombres} #{ciudadano.apellidos}"/>
                                                    </c:if>
                                                </c:forEach>
                                            </c:forEach>

                                        </c:if>

                                        <c:if test="#{empty jrvBean.listaJrvs}">

                                            <f:selectItems value="#{jrvBean.listaCiudadanos}" var="ciudadano"
                                                           itemValue="#{ciudadano}"
                                                           itemLabel="#{ciudadano.nombres} #{ciudadano.apellidos}"/>

                                        </c:if>
                                    </h:selectOneMenu>
                                </div>
                                <div class="form-group">
                                    <h:outputLabel value="Seleccione un vocal" for="vocal" />
                                    <h:selectOneMenu id="vocal" class="form-control vocal" value="#{jrvBean.jrv.idVocal}" title="IdVocal" required="true" requiredMessage="No hay ciudadanos para vocales disponibles">
                                        <c:if test="#{not empty jrvBean.listaJrvs}">

                                            <c:forEach items="#{jrvBean.listaJrvs}" var="jrv">

                                                <c:forEach items="#{jrvBean.listaCiudadanos}" var="ciudadano">
                                                    <c:if test="#{(jrvBean.jrv.idVocal ne ciudadano.idCiudadano) and (jrv.idSecretario.idCiudadano ne ciudadano.idCiudadano)}">
                                                        <f:selectItem itemValue="#{ciudadano}"
                                                                      itemLabel="#{ciudadano.nombres} #{ciudadano.apellidos}"/>
                                                    </c:if>
                                                </c:forEach>
                                            </c:forEach>
                                        </c:if>

                                        <c:if test="#{empty jrvBean.listaJrvs}">

                                            <f:selectItems value="#{jrvBean.listaCiudadanos}" var="ciudadano"
                                                           itemValue="#{ciudadano}"
                                                           itemLabel="#{ciudadano.nombres} #{ciudadano.apellidos}"/>

                                        </c:if>
                                    </h:selectOneMenu>
                                </div>
                            </div> 
                        </div>

                        <h:commandButton class="btn btn-primary btn-lg pull-right" action="#{jrvBean.modificarJrv()}" value="Registrar"/>
                    </h:form>
                </div> <!-- contact-form -->           
            </div>
        </section>



        <script>
            $(document).ready(function () {

                function matchCustom(params, data) {

                    if ($.trim(params.term) === '') {
                        return data;
                    }

                    if (typeof data.text === 'undefined') {
                        return null;
                    }

                    if (data.text.indexOf(params.term) > -1) {
                        var modifiedData = $.extend({}, data, true);

                        return modifiedData;
                    }

                    if (data.id.indexOf(params.term) > -1) {
                        var modifiedData = $.extend({}, data, true);

                        return modifiedData;
                    }


                    return null;
                }

                $('.centroVotacion').select2({
                    language: "es"
                });

                $('.presidente').select2({
                    language: "es"
                });


                $('.secretario').select2({
                    matcher: matchCustom

                });
                $('.vocal').select2({
                    matcher: matchCustom
                });

            });

        </script>



    </ui:define>

</ui:composition>
